<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <script src="/js/theme-toggle.js"></script>
    <meta charset="UTF-8">
    <title>QuickDrop Admin</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <link href="/css/tailwind.css" rel="stylesheet">
</head>
<body>
<!-- Navbar -->
<nav class="bg-slate-800 dark:bg-slate-900">
    <div class="container mx-auto flex items-center justify-between p-4">
        <a href="/" class="flex items-center text-white font-semibold">
            <img src="/images/favicon.png" alt="QuickDrop Logo" class="h-10 mr-2">
            QuickDrop Admin
        </a>
        <div class="flex items-center space-x-4">
            <a href="/admin/settings" class="text-white hover:underline">Settings</a>
            <a href="/" class="text-white hover:underline">Home</a>
            <button id="themeToggle" type="button" class="text-white rounded-full p-1 focus:outline-none focus:ring-2 focus:ring-brand-light dark:focus:ring-brand-dark">ðŸŒ™</button>
        </div>
    </div>
</nav>

<!-- Main Content -->
<div class="container mx-auto my-5 space-y-8">
    <h1 class="text-center mb-4 font-semibold tracking-tight">Admin Dashboard</h1>

    <!-- Analytics Section -->
    <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-lg p-6 md:p-8">
        <h2 class="font-semibold tracking-tight mb-4">Analytics</h2>
        <div class="grid md:grid-cols-2 gap-4">
            <div>
                <h5 class="font-semibold">Total Downloads</h5>
                <small class="text-gray-600 dark:text-gray-400">Excluding deleted files</small>
                <p class="text-gray-600 dark:text-gray-400 text-lg" th:text="${analytics.totalDownloads}">0</p>
            </div>
            <div>
                <h5 class="font-semibold">Total Space Used</h5>
                <p class="text-gray-600 dark:text-gray-400 text-lg" th:text="${analytics.totalSpaceUsed}">0 MB</p>
            </div>
        </div>
    </div>

    <!-- Files Section -->
    <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-lg p-6 md:p-8">
        <h2 class="font-semibold tracking-tight mb-4">Files</h2>
        <!-- DESKTOP/TABLE LAYOUT (hidden on small screens) -->
        <div class="hidden md:block overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                <thead class="bg-gray-50 dark:bg-gray-800">
                <tr>
                    <th class="px-3 py-2 text-left">Name</th>
                    <th class="px-3 py-2 text-left">Upload Date/Last Renewed</th>
                    <th class="px-3 py-2 text-left">Size</th>
                    <th class="px-3 py-2 text-left">Downloads</th>
                    <th class="px-3 py-2 text-center">Keep Indefinitely</th>
                    <th class="px-3 py-2 text-center">Hidden</th>
                    <th class="px-3 py-2 text-right">Actions</th>
                </tr>
                </thead>
                <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                <tr th:each="file : ${files}">
                    <td class="px-3 py-2" th:text="${file.name}"></td>
                    <td class="px-3 py-2" th:text="${#temporals.format(file.uploadDate, 'dd.MM.yyyy')}"></td>
                    <td class="px-3 py-2" th:text="${file.size}">--</td>
                    <td class="px-3 py-2" th:text="${file.totalDownloads}">--</td>
                    <td class="px-3 py-2 text-center">
                        <form class="inline" method="post" th:action="@{/admin/keep-indefinitely/{uuid}(uuid=${file.uuid})}">
                            <input th:name="${_csrf.parameterName}" th:value="${_csrf.token}" type="hidden">
                            <input name="keepIndefinitely" type="hidden" value="false">
                            <input class="rounded focus:outline-none focus:ring-2 focus:ring-brand-light dark:focus:ring-brand-dark" name="keepIndefinitely" onchange="updateCheckboxState(event, this)" th:checked="${file.keepIndefinitely}" type="checkbox" value="true">
                        </form>
                    </td>
                    <td class="px-3 py-2 text-center">
                        <form class="inline" method="post" th:action="@{/admin/toggle-hidden/{uuid}(uuid=${file.uuid})}">
                            <input th:name="${_csrf.parameterName}" th:value="${_csrf.token}" type="hidden">
                            <input name="hidden" type="hidden" value="false">
                            <input class="rounded focus:outline-none focus:ring-2 focus:ring-brand-light dark:focus:ring-brand-dark" name="hidden" onchange="updateHiddenState(event, this)" th:checked="${file.hidden}" type="checkbox" value="true">
                        </form>
                    </td>
                    <td class="px-3 py-2 text-right">
                        <div class="flex flex-wrap gap-2 justify-end">
                            <a class="bg-sky-500 dark:bg-sky-400 text-white px-2 py-1 rounded text-sm" th:href="@{/file/{uuid}(uuid=${file.uuid})}">View</a>
                            <a class="bg-yellow-500 text-white px-2 py-1 rounded text-sm" th:href="@{/file/history/{uuid}(uuid=${file.uuid})}">History</a>
                            <a class="bg-green-600 text-white px-2 py-1 rounded text-sm" th:href="@{/file/download/{uuid}(uuid=${file.uuid})}">Download</a>
                            <form class="inline" method="post" onsubmit="return confirmDelete();" th:action="@{/admin/delete/{uuid}(uuid=${file.uuid})}">
                                <input th:name="${_csrf.parameterName}" th:value="${_csrf.token}" type="hidden">
                                <button class="bg-red-600 text-white px-2 py-1 rounded text-sm" type="submit">Delete</button>
                            </form>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- MOBILE/CARD LAYOUT (hidden on md+ screens) -->
        <div class="md:hidden space-y-4">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4" th:each="file : ${files}">
                <h5 class="font-semibold" th:text="${file.name}">File Name</h5>
                <p class="mt-1"><strong>Uploaded/Renewed:</strong> <span th:text="${#temporals.format(file.uploadDate, 'dd.MM.yyyy')}"></span></p>
                <p><strong>Size:</strong> <span th:text="${file.size}">--</span></p>
                <p><strong>Downloads:</strong> <span th:text="${file.totalDownloads}">--</span></p>
                <div class="my-2 space-y-2">
                    <form class="inline-flex items-center space-x-2" method="post" th:action="@{/admin/keep-indefinitely/{uuid}(uuid=${file.uuid})}">
                        <input th:name="${_csrf.parameterName}" th:value="${_csrf.token}" type="hidden">
                        <input name="keepIndefinitely" type="hidden" value="false">
                        <label class="flex items-center"><input class="mr-2 rounded focus:outline-none focus:ring-2 focus:ring-brand-light dark:focus:ring-brand-dark" name="keepIndefinitely" onchange="updateCheckboxState(event, this)" th:checked="${file.keepIndefinitely}" type="checkbox" value="true">Keep Indefinitely</label>
                    </form>
                    <form class="inline-flex items-center space-x-2" method="post" th:action="@{/admin/toggle-hidden/{uuid}(uuid=${file.uuid})}">
                        <input th:name="${_csrf.parameterName}" th:value="${_csrf.token}" type="hidden">
                        <input name="hidden" type="hidden" value="false">
                        <label class="flex items-center"><input class="mr-2 rounded focus:outline-none focus:ring-2 focus:ring-brand-light dark:focus:ring-brand-dark" name="hidden" onchange="updateHiddenState(event, this)" th:checked="${file.hidden}" type="checkbox" value="true">Hidden</label>
                    </form>
                </div>
                <div class="flex flex-wrap gap-2 justify-end mt-3">
                    <a class="bg-sky-500 dark:bg-sky-400 text-white px-2 py-1 rounded text-sm" th:href="@{/file/{uuid}(uuid=${file.uuid})}">View</a>
                    <a class="bg-yellow-500 text-white px-2 py-1 rounded text-sm" th:href="@{/file/history/{uuid}(uuid=${file.uuid})}">History</a>
                    <a class="bg-green-600 text-white px-2 py-1 rounded text-sm" th:href="@{/file/download/{uuid}(uuid=${file.uuid})}">Download</a>
                    <form class="inline" method="post" onsubmit="return confirmDelete();" th:action="@{/admin/delete/{uuid}(uuid=${file.uuid})}">
                        <input th:name="${_csrf.parameterName}" th:value="${_csrf.token}" type="hidden">
                        <button class="bg-red-600 text-white px-2 py-1 rounded text-sm" type="submit">Delete</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div><!-- /.container -->

<script>
    function updateHiddenState(event, checkbox) {
        event.preventDefault();
        const hiddenField = checkbox.form.querySelector('input[name="hidden"][type="hidden"]');
        if (hiddenField) {
            hiddenField.value = checkbox.checked;
        }
        checkbox.form.submit();
    }

    function confirmDelete() {
        return confirm("Are you sure you want to delete this file? This action cannot be undone.");
    }

    function updateCheckboxState(event, checkbox) {
        event.preventDefault();
        const hiddenField = checkbox.form.querySelector('input[name="keepIndefinitely"][type="hidden"]');
        if (hiddenField) {
            hiddenField.value = checkbox.checked;
        }
        checkbox.form.submit();
    }
</script>
</body>
</html>
