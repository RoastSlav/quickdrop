<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>Admin Settings</title>

    <link href="/css/tailwind.css" rel="stylesheet">
    <link href="/css/custom.css" rel="stylesheet">
    <link href="/images/favicon.png" rel="icon" type="image/png">

    <script src="/js/tailwindTheme.js"></script>
</head>

<body class="bg-gray-50 text-gray-800 dark:bg-slate-900 dark:text-gray-100">
<nav class="bg-gray-800 dark:bg-gray-900 text-gray-100">
    <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
        <a class="flex items-center space-x-2" href="/">
            <img alt="QuickDrop Logo" class="h-10" src="/images/favicon.png">
            <span class="font-semibold tracking-tight">QuickDrop Admin</span>
        </a>

        <div class="flex items-center space-x-4">
            <a class="hover:text-white" href="/admin/dashboard">Dashboard</a>
            <button class="rounded-lg p-2 transition-colors hover:bg-sky-600 dark:hover:bg-sky-500 active:scale-95 focus:outline-none focus:ring-2 focus:ring-sky-500" id="themeToggle"
                    type="button">
                üåô
            </button>
        </div>
    </div>
</nav>

<main class="max-w-7xl mx-auto px-4 py-6 md:py-8">
    <header class="text-center mb-8 space-y-1">
        <h1 class="text-3xl md:text-4xl font-semibold tracking-tight">Admin Settings</h1>
    </header>

    <form class="space-y-10" method="post" th:action="@{/admin/save}" th:object="${settings}">

        <!-- File Settings -->
        <section class="bg-white dark:bg-slate-800 p-6 md:p-8 rounded-2xl shadow-lg">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold tracking-tight">File Settings</h2>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium mb-1">Max File Size (MB)</label>
                    <input class="w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-500" required th:field="*{maxFileSize}"
                           type="text">
                </div>

                <div>
                    <label class="block text-sm font-medium mb-1">Max File Lifetime (days)</label>
                    <input class="w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-500" required th:field="*{maxFileLifeTime}"
                           type="text">
                </div>

                <div class="md:col-span-2">
                    <label class="block text-sm font-medium mb-1">File Storage Path</label>
                    <input class="w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-500" required th:field="*{fileStoragePath}"
                           type="text">
                </div>

                <div class="md:col-span-2 rounded-xl border border-slate-200 dark:border-slate-700 p-4">
                    <div class="text-sm font-medium mb-2">Keep Indefinitely</div>
                    <label class="flex items-start gap-3 pl-2">
                        <input class="mt-1 h-4 w-4 rounded border-gray-400 dark:border-gray-600 accent-sky-500 dark:accent-sky-400 focus:ring-sky-500"
                               id="keepIndefinitelyAdminOnly" th:field="*{keepIndefinitelyAdminOnly}" type="checkbox">
                        <span>
                            <span class="text-sm">Require admin session for ‚ÄúKeep indefinitely‚Äù</span><br>
                            <span class="text-xs text-gray-600 dark:text-gray-400">When enabled, only admins with an active session can mark uploads to keep indefinitely.</span>
                        </span>
                    </label>
                </div>
            </div>
        </section>

        <!-- System Settings -->
        <section class="bg-white dark:bg-slate-800 p-6 md:p-8 rounded-2xl shadow-lg">
            <h2 class="text-xl font-semibold tracking-tight mb-4">System Settings</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                <!-- TOP: Cron (full width) -->
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium mb-1">File Deletion Cron Expression</label>
                    <input class="w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-500" required th:field="*{fileDeletionCron}"
                           type="text">
                </div>

                <!-- MIDDLE: Lifetime (left) -->
                <div>
                    <label class="block text-sm font-medium mb-1">Session Lifetime (minutes)</label>
                    <p class="text-xs text-gray-600 dark:text-gray-400 mb-1">
                        This impacts how long file and admin sessions are kept.
                    </p>
                    <input class="w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-500" min="0" required th:field="*{sessionLifeTime}"
                           type="number">
                </div>

                <!-- MIDDLE: Default Home Page (right) -->
                <div class="rounded-xl border border-slate-200 dark:border-slate-700 p-4 h-full">
                    <label class="block text-sm font-medium mb-2" for="defaultHomePage">Default Home Page</label>
                    <select class="w-full rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-500" id="defaultHomePage"
                            th:field="*{defaultHomePage}">
                        <option value="upload">Upload Page</option>
                        <option value="list">File List Page</option>
                    </select>
                </div>

                <!-- BOTTOM: File List Enabled (left) -->
                <div class="rounded-xl border border-slate-200 dark:border-slate-700 p-4 h-full">
                    <div class="text-sm font-medium mb-2">File List</div>
                    <label class="flex items-center gap-3 pl-2">
                        <input class="h-4 w-4 rounded border-gray-400 dark:border-gray-600 accent-sky-500 dark:accent-sky-400 focus:ring-sky-500" id="fileListPageEnabled" th:field="*{fileListPageEnabled}"
                               type="checkbox">
                        <span class="text-sm">Enable File List Page</span>
                    </label>
                </div>

                <!-- BOTTOM: Admin Dashboard Button Enabled (right) -->
                <div class="rounded-xl border border-slate-200 dark:border-slate-700 p-4 h-full">
                    <div class="text-sm font-medium mb-2">Admin Dashboard</div>
                    <label class="flex items-start gap-3 pl-2">
                        <input class="mt-1 h-4 w-4 rounded border-gray-400 dark:border-gray-600 accent-sky-500 dark:accent-sky-400 focus:ring-sky-500" id="adminDashboardButtonEnabled"
                               th:field="*{adminDashboardButtonEnabled}"
                               type="checkbox">
                        <span>
                    <span class="text-sm">Show Admin Dashboard Button</span><br>
                    <span class="text-xs text-gray-600 dark:text-gray-400">
                        Still available at /admin/dashboard
                    </span>
                </span>
                    </label>
                </div>

            </div>
        </section>

        <!-- Security Settings -->
        <section class="bg-white dark:bg-slate-800 p-6 md:p-8 rounded-2xl shadow-lg">
            <h2 class="text-xl font-semibold tracking-tight mb-4">Security Settings</h2>

            <div class="space-y-5">
                <div class="rounded-xl border border-slate-200 dark:border-slate-700 p-4">
                    <label class="flex items-start gap-3 pl-2">
                        <input class="mt-1 h-4 w-4 rounded border-gray-400 dark:border-gray-600 accent-sky-500 dark:accent-sky-400 focus:ring-sky-500" id="appPasswordEnabled" onclick="togglePasswordField()"
                               th:field="*{appPasswordEnabled}"
                               type="checkbox">
                        <span>
                            <span class="text-sm font-medium">Enable Password Protection</span><br>
                            <span class="text-xs text-gray-600 dark:text-gray-400">Protect the whole app with a password</span>
                        </span>
                    </label>

                    <!-- App Password -->
                    <div class="mt-4 hidden" id="passwordInputGroup">
                        <label class="block text-sm font-medium mb-1">App Password</label>
                        <input class="w-full max-w-md rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-500" th:field="*{appPassword}"
                               type="password">
                    </div>
                </div>

                <div class="rounded-xl border border-slate-200 dark:border-slate-700 p-4">
                    <label class="flex items-start gap-3">
                        <input class="mt-1 h-4 w-4 rounded border-gray-400 dark:border-gray-600 accent-sky-500 dark:accent-sky-400 focus:ring-sky-500" id="encryptionDisabled" th:field="*{encryptionDisabled}"
                               type="checkbox">
                        <span>
                            <span class="text-sm font-medium">Disable File Encryption</span><br>
                            <span class="text-xs text-gray-600 dark:text-gray-400">
                                If checked, files will not be encrypted even if file password protection is enabled.
                            </span>
                        </span>
                    </label>
                </div>
            </div>
        </section>

        <!-- Save Button -->
        <div class="flex justify-center">
            <button class="rounded-lg bg-sky-500 hover:bg-sky-600 dark:bg-sky-400 dark:hover:bg-sky-500 text-white font-medium px-6 py-2 transition-colors active:scale-95 focus:outline-none focus:ring-2 focus:ring-sky-500"
                    type="submit">
                Save Settings
            </button>
        </div>
    </form>

    <!-- About -->
    <section class="bg-white dark:bg-slate-800 p-6 md:p-8 rounded-2xl shadow-lg mt-12">
        <h2 class="text-2xl font-semibold tracking-tight mb-6">About QuickDrop</h2>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
            <div class="rounded-xl border border-slate-200 dark:border-slate-700 p-5">
                <div class="text-sm text-gray-600 dark:text-gray-400">Version</div>
                <div class="text-lg font-semibold mt-1" th:text="${aboutInfo.appVersion}">1.0.0</div>
            </div>

            <div class="rounded-xl border border-slate-200 dark:border-slate-700 p-5">
                <div class="text-sm text-gray-600 dark:text-gray-400">Database</div>
                <div class="text-lg font-semibold mt-1">
                    SQLite <span class="font-normal" th:text="${aboutInfo.sqliteVersion}">Unknown</span>
                </div>
            </div>

            <div class="rounded-xl border border-slate-200 dark:border-slate-700 p-5">
                <div class="text-sm text-gray-600 dark:text-gray-400">Java Version</div>
                <div class="text-lg font-semibold mt-1" th:text="${aboutInfo.javaVersion}">N/A</div>
            </div>

            <div class="rounded-xl border border-slate-200 dark:border-slate-700 p-5">
                <div class="text-sm text-gray-600 dark:text-gray-400">OS Info</div>
                <div class="text-lg font-semibold mt-1" th:text="${aboutInfo.osInfo}">N/A</div>
            </div>
        </div>
    </section>
</main>

<script src="/js/settings.js"></script>

<!-- Keep existing JS hook; this makes the password field show/hide without changing your settings.js -->
<script>
    function togglePasswordField() {
        const group = document.getElementById('passwordInputGroup');
        const enabled = document.getElementById('appPasswordEnabled')?.checked;
        if (!group) return;
        group.classList.toggle('hidden', !enabled);
    }

    document.addEventListener('DOMContentLoaded', () => {
        // Ensure correct initial state on page load
        togglePasswordField();
    });
</script>
</body>
</html>
