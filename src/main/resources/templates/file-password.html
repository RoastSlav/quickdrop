<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Enter Password</title>
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <link href="/css/tailwind.css" rel="stylesheet" />
    <link href="/css/custom.css" rel="stylesheet" />
    <link href="/images/favicon.png" rel="icon" type="image/png" />
    <script src="/js/tailwindTheme.js"></script>
  </head>
  <body class="bg-gray-50 text-gray-800 dark:bg-slate-900 dark:text-gray-100">
    <nav class="bg-gray-800 dark:bg-gray-900 text-gray-100">
      <div class="max-w-7xl mx-auto px-4 py-4 relative">
        <div class="flex items-center justify-between">
          <a class="flex items-center space-x-2" href="/">
            <img alt="Website Logo" class="h-10" src="/images/favicon.png" />
            <span class="font-semibold tracking-tight">QuickDrop</span>
          </a>
          <button
            aria-controls="navMenu"
            aria-expanded="false"
            aria-label="Toggle navigation"
            class="md:hidden rounded-lg p-2 hover:bg-sky-600 dark:hover:bg-sky-500 focus:outline-none focus:ring-2 focus:ring-sky-500"
            id="navToggle"
            type="button"
          >
            <svg
              aria-hidden="true"
              class="h-6 w-6"
              fill="none"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              viewBox="0 0 24 24"
            >
              <path d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>
          <div
            class="nav-menu-panel hidden md:flex flex-col md:flex-row md:items-center md:space-x-4 w-full md:w-auto mt-3 md:mt-0 space-y-2 md:space-y-0 bg-gray-800 dark:bg-gray-900 md:bg-transparent md:dark:bg-transparent rounded-lg md:rounded-none p-4 md:p-0 shadow md:shadow-none absolute left-0 right-0 top-full md:static z-20 md:ml-auto"
            id="navMenu"
          >
            <div
              class="flex flex-col space-y-2 md:flex-row md:items-center md:space-x-4 md:space-y-0"
            >
              <a
                class="nav-menu-item hover:text-white"
                href="/file/list"
                th:if="${isFileListPageEnabled}"
                >View Files</a
              >
              <a class="nav-menu-item hover:text-white" href="/file/upload"
                >Upload File</a
              >
            </div>
            <button
              aria-label="Toggle theme"
              class="nav-menu-item theme-toggle rounded-lg p-2 transition-colors hover:bg-sky-600 dark:hover:bg-sky-500 active:scale-95 focus:outline-none focus:ring-2 focus:ring-sky-500"
              id="themeToggle"
              type="button"
            >
              ðŸŒ™
            </button>
          </div>
        </div>
      </div>
    </nav>
    <main class="max-w-7xl mx-auto px-4 py-6 md:py-8">
      <header class="text-center mb-8">
        <h1 class="text-3xl md:text-4xl font-semibold tracking-tight">
          Enter Password
        </h1>
      </header>
      <div class="grid grid-cols-12 gap-4">
        <div
          class="col-span-12 md:col-span-8 md:col-start-3 lg:col-span-6 lg:col-start-4"
        >
          <form
            class="bg-white dark:bg-slate-800 p-6 md:p-8 rounded-2xl shadow-lg flex flex-col gap-6"
            id="passwordForm"
            method="post"
            th:action="@{/file/password}"
          >
            <input
              th:name="${_csrf.parameterName}"
              th:value="${_csrf.token}"
              type="hidden"
            />
            <input name="uuid" th:value="${uuid}" type="hidden" />
            <h2
              class="text-center text-lg font-semibold text-gray-900 dark:text-gray-100"
              th:if="${fileName}"
              th:text="${fileName}"
            ></h2>
            <label class="sr-only" for="password-input">Password</label>
            <div class="relative w-full">
              <input
                autocomplete="current-password"
                class="block w-full rounded-full border border-slate-300 dark:border-slate-600 bg-white dark:bg-gray-700 px-4 py-3 pr-12 text-lg text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:border-sky-500 focus:ring-2 focus:ring-sky-500 focus:outline-none"
                id="password-input"
                name="password"
                placeholder="Enter the file passwordâ€¦"
                required
                style="line-height: 2.7rem"
                type="password"
              />
              <button
                aria-label="Show password"
                class="absolute right-3 top-1/2 -translate-y-1/2 flex items-center text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 focus-visible:ring-2 focus-visible:ring-sky-500 p-2"
                id="showPassword"
                type="button"
              >
                <svg
                  class="h-5 w-5"
                  fill="none"
                  id="eyeIcon"
                  stroke="currentColor"
                  stroke-width="1.5"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <g id="eye-open">
                    <path
                      d="M2.03555 12.3224C1.96647 12.1151 1.9664 11.8907 2.03536 11.6834C3.42372 7.50972 7.36079 4.5 12.0008 4.5C16.6387 4.5 20.5742 7.50692 21.9643 11.6776C22.0334 11.8849 22.0335 12.1093 21.9645 12.3166C20.5761 16.4903 16.6391 19.5 11.9991 19.5C7.36119 19.5 3.42564 16.4931 2.03555 12.3224Z"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M15 12C15 13.6569 13.6569 15 12 15C10.3431 15 9 13.6569 9 12C9 10.3431 10.3431 9 12 9C13.6569 9 15 10.3431 15 12Z"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </g>
                  <g class="hidden" id="eye-closed">
                    <path
                      d="M3.97993 8.22257C3.05683 9.31382 2.35242 10.596 1.93436 12.0015C3.22565 16.338 7.24311 19.5 11.9991 19.5C12.9917 19.5 13.9521 19.3623 14.8623 19.1049M6.22763 6.22763C7.88389 5.13558 9.86771 4.5 12 4.5C16.756 4.5 20.7734 7.66205 22.0647 11.9985C21.3528 14.3919 19.8106 16.4277 17.772 17.772"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M6.22763 6.22763L3 3M6.22763 6.22763L9.87868 9.87868M17.772 17.772L21 21M17.772 17.772L14.1213 14.1213M14.1213 14.1213C14.6642 13.5784 15 12.8284 15 12C15 10.3431 13.6569 9 12 9C11.1716 9 10.4216 9.33579 9.87868 9.87868M14.1213 14.1213L9.87868 9.87868"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </g>
                </svg>
              </button>
            </div>
            <div class="pt-2 text-center">
              <button
                class="rounded-lg bg-sky-500 hover:bg-sky-600 dark:bg-sky-400 dark:hover:bg-sky-500 text-white font-medium px-4 py-2 transition-colors active:scale-95 focus:outline-none focus:ring-2 focus:ring-sky-500"
                type="submit"
              >
                Submit
              </button>
            </div>
          </form>
        </div>
      </div>
    </main>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const btn = document.getElementById("showPassword");
        const input = document.getElementById("password-input");
        const eyeOpen = document.querySelector("#eye-open");
        const eyeClosed = document.querySelector("#eye-closed");
        if (btn && input && eyeOpen && eyeClosed) {
          btn.addEventListener("click", () => {
            const show = input.getAttribute("type") === "password";
            input.setAttribute("type", show ? "text" : "password");
            eyeOpen.classList.toggle("hidden", show);
            eyeClosed.classList.toggle("hidden", !show);
          });
        }

        const form = document.getElementById("passwordForm");
        const uuidInput = document.querySelector('input[name="uuid"]');
        if (form && input && uuidInput) {
          form.addEventListener("submit", () => {
            const uuid = uuidInput.value?.trim();
            const pwd = input.value?.trim();
            if (uuid && pwd) {
              sessionStorage.setItem(`filePass:${uuid}`, pwd);
            }
          });
        }
      });
    </script>
  </body>
</html>
